<ion-header>
  <ion-toolbar>
    <ion-title>Camera Preview</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card>
    <ion-card-header>
      <ion-card-title>Available Devices</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item-divider>
          <ion-label>Rear Cameras</ion-label>
        </ion-item-divider>
        @for(device of rearCameras(); track device.deviceId){
        <ion-item>
          <ion-label>
            <h3>
              {{ device.label }} {{ device.isLogical ? '(Logical - Default)' :
              '' }}
            </h3>
            <p>ID: {{ device.deviceId }}</p>
            <p>Zoom: {{ device.minZoom }}x - {{ device.maxZoom }}x</p>
            @for(lens of device.lenses; track lens.deviceType){
            <p class="lens-info">
              Lens: {{ lens.deviceType }} ({{ lens.baseZoomRatio }}x)
            </p>
            }
          </ion-label>
        </ion-item>
        }
      </ion-list>
      <ion-list>
        <ion-item-divider>
          <ion-label>Front Cameras</ion-label>
        </ion-item-divider>
        @for(device of frontCameras(); track device.deviceId){
        <ion-item>
          <ion-label>
            <h3>
              {{ device.label }} {{ device.isLogical ? '(Logical - Default)' :
              '' }}
            </h3>
            <p>ID: {{ device.deviceId }}</p>
            <p>Zoom: {{ device.minZoom }}x - {{ device.maxZoom }}x</p>
            @for(lens of device.lenses; track lens.deviceType){
            <p class="lens-info">
              Lens: {{ lens.deviceType }} ({{ lens.baseZoomRatio }}x)
            </p>
            }
          </ion-label>
        </ion-item>
        }
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card>
    <ion-card-header>
      <ion-card-title>Camera Settings</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="full" class="ion-margin-bottom">
        <ion-item>
          <ion-select
            [(ngModel)]="deviceId"
            label="Device"
            placeholder="Default camera device"
            label-placement="floating"
          >
            <ion-select-option [value]="null">
              Default camera device
            </ion-select-option>

            @for (device of cameraDevices(); track device.deviceId) {
            <ion-select-option value="{{ device.deviceId }}">
              ({{ device.position }}) - {{ device.label }} ({{
              device.lenses.length }} lenses)
            </ion-select-option>
            }
          </ion-select>
        </ion-item>

        @if (!deviceId()) {
        <ion-item>
          <ion-select
            [(ngModel)]="position"
            label="Camera Position"
            label-placement="floating"
          >
            <ion-select-option value="back">Back</ion-select-option>
            <ion-select-option value="front">Front</ion-select-option>
          </ion-select>
        </ion-item>
        }

        <ion-item>
          <ion-range
            [(ngModel)]="quality"
            min="0"
            max="100"
            step="1"
            [label]="'Photo Quality (' + quality() + ')'"
            labelPlacement="stacked"
          >
            <ion-icon size="small" slot="start" name="sunny-outline"></ion-icon>
            <ion-icon slot="end" name="sunny"></ion-icon>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-range
            [(ngModel)]="initialZoomFactor"
            min="1.0"
            max="3.0"
            step="0.1"
            snaps="true"
            [label]="'Initial Zoom Level (' + initialZoomFactor() + 'x)'"
            labelPlacement="stacked"
          >
            <ion-icon
              size="small"
              slot="start"
              name="search-outline"
            ></ion-icon>
            <ion-icon slot="end" name="search"></ion-icon>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-checkbox
            [(ngModel)]="useTripleCameraIfAvailable"
            color="primary"
            justify="space-between"
          >
            Use Triple Camera (iPhone Pro only)
          </ion-checkbox>
        </ion-item>
      </ion-list>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Preview Settings</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item>
              <ion-label>X</ion-label>
              <ion-input
                [(ngModel)]="previewX"
                type="number"
                placeholder="0"
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-label>Y</ion-label>
              <ion-input
                [(ngModel)]="previewY"
                type="number"
                placeholder="0"
              ></ion-input>
            </ion-item>
            @if (aspectRatio() === 'custom') {
            <ion-item>
              <ion-label>Width</ion-label>
              <ion-input
                [(ngModel)]="previewWidth"
                type="number"
                placeholder="auto"
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-label>Height</ion-label>
              <ion-input
                [(ngModel)]="previewHeight"
                type="number"
                placeholder="auto"
              ></ion-input>
            </ion-item>
            }
            <ion-item>
              <ion-label>Aspect Ratio</ion-label>
              <ion-select [(ngModel)]="aspectRatio" interface="popover">
                <ion-select-option value="4:3">4:3</ion-select-option>
                <ion-select-option value="16:9">16:9</ion-select-option>
                <ion-select-option value="custom">Custom</ion-select-option>
              </ion-select>
            </ion-item>
          </ion-list>

          <ion-item-divider>Preset Positions &amp; Sizes</ion-item-divider>
          <ion-grid>
            <ion-row class="ion-justify-content-around">
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setPreset('full')"
                  >Full Screen</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setPreset('top-left')"
                  >Top Left</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setPreset('bottom-right')"
                  >Bottom Right</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setPreset('small-center')"
                  >Small Center</ion-button
                >
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card-content>
      </ion-card>

      <ion-card>
        <ion-card-header>
          <ion-card-title>Picture Settings</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <ion-list>
            <ion-item>
              <ion-select
                [(ngModel)]="pictureFormat"
                label="Picture Format"
                label-placement="floating"
              >
                <ion-select-option value="jpeg">JPEG</ion-select-option>
                <ion-select-option value="png">PNG</ion-select-option>
              </ion-select>
            </ion-item>
            <ion-item>
              <ion-range
                [(ngModel)]="pictureQuality"
                min="0"
                max="100"
                step="1"
                [label]="'Picture Quality (' + pictureQuality() + ')'"
                labelPlacement="stacked"
              >
                <ion-icon
                  size="small"
                  slot="start"
                  name="sad-outline"
                ></ion-icon>
                <ion-icon slot="end" name="happy"></ion-icon>
              </ion-range>
            </ion-item>
            <ion-item>
              <ion-checkbox
                [(ngModel)]="useCustomSize"
                color="primary"
                justify="space-between"
              >
                Use Custom Size
              </ion-checkbox>
            </ion-item>
            @if (useCustomSize()) {
            <ion-item>
              <ion-label>Width</ion-label>
              <ion-input
                [(ngModel)]="pictureWidth"
                type="number"
                placeholder="1920"
              ></ion-input>
            </ion-item>
            <ion-item>
              <ion-label>Height</ion-label>
              <ion-input
                [(ngModel)]="pictureHeight"
                type="number"
                placeholder="1080"
              ></ion-input>
            </ion-item>
            }
          </ion-list>

          <ion-item-divider>Aspect Ratio Capture</ion-item-divider>
          <div class="ion-padding-bottom">
            <p class="ion-text-center">
              <strong>Test capture with aspect ratios (no custom size)</strong>
            </p>
            <div class="ion-text-center ion-margin-bottom">
              <ion-button
                (click)="testAspectRatioFeature()"
                fill="solid"
                size="small"
                color="success"
              >
                <ion-icon name="information-circle" slot="start"></ion-icon>
                Test Aspect Ratio Info
              </ion-button>
            </div>
            <ion-grid>
              <ion-row class="ion-justify-content-around">
                <ion-col size="auto">
                  <ion-button
                    fill="outline"
                    size="small"
                    color="tertiary"
                    (click)="quickTestAspectRatioCapture('4:3')"
                  >
                    4:3 Capture
                  </ion-button>
                </ion-col>
                <ion-col size="auto">
                  <ion-button
                    fill="outline"
                    size="small"
                    color="tertiary"
                    (click)="quickTestAspectRatioCapture('16:9')"
                  >
                    16:9 Capture
                  </ion-button>
                </ion-col>
              </ion-row>
            </ion-grid>
          </div>

          <ion-item-divider>Capture Size Presets</ion-item-divider>
          <ion-grid>
            <ion-row class="ion-justify-content-around">
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('vga')"
                  >VGA</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('hd')"
                  >HD</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('fullhd')"
                  >Full HD</ion-button
                >
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-around ion-margin-top">
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('4k')"
                  >4K UHD</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('square')"
                  >Square</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('portrait')"
                  >Portrait</ion-button
                >
              </ion-col>
            </ion-row>
            <ion-row class="ion-justify-content-around ion-margin-top">
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('small')"
                  >Small</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  (click)="setCapturePreset('large')"
                  >Large</ion-button
                >
              </ion-col>
              <ion-col size="auto">
                <ion-button
                  fill="outline"
                  size="small"
                  color="danger"
                  (click)="setCapturePreset('disable')"
                  >Disable Custom</ion-button
                >
              </ion-col>
            </ion-row>
          </ion-grid>

          @if (useCustomSize()) {
          <div class="ion-margin-top">
            <p>
              <strong>Current Size:</strong> {{ pictureWidth() }} x {{
              pictureHeight() }} px
            </p>
          </div>
          }
        </ion-card-content>
      </ion-card>

      <h3>Camera Behavior</h3>
      <ion-list lines="full" class="ion-margin-bottom">
        <ion-item>
          <ion-range
            [(ngModel)]="opacity"
            min="0"
            max="100"
            step="10"
            [label]="'Camera Opacity (' + opacity() + '%)'"
            labelPlacement="stacked"
          >
            <ion-icon
              size="small"
              slot="start"
              name="eye-off-outline"
            ></ion-icon>
            <ion-icon slot="end" name="eye"></ion-icon>
          </ion-range>
        </ion-item>

        <ion-item>
          <ion-checkbox
            [(ngModel)]="enableZoom"
            color="primary"
            justify="space-between"
          >
            Enable Zoom
          </ion-checkbox>
        </ion-item>

        <ion-item>
          <ion-checkbox
            [(ngModel)]="disableAudio"
            color="primary"
            justify="space-between"
          >
            Disable Audio Stream
          </ion-checkbox>
        </ion-item>

        <ion-item>
          <ion-checkbox
            [(ngModel)]="lockAndroidOrientation"
            color="primary"
            justify="space-between"
          >
            Lock Android Orientation
          </ion-checkbox>
        </ion-item>
        <ion-item>
          <ion-checkbox
            [(ngModel)]="saveToGallery"
            color="primary"
            justify="space-between"
          >
            Save to Gallery
          </ion-checkbox>
        </ion-item>
        <ion-item>
          <ion-checkbox
            [(ngModel)]="withExifLocation"
            color="primary"
            justify="space-between"
          >
            With Exif Location
          </ion-checkbox>
        </ion-item>

        <ion-item>
          <ion-select
            [(ngModel)]="gridMode"
            label="Grid Overlay"
            label-placement="floating"
          >
            <ion-select-option value="none">None</ion-select-option>
            <ion-select-option value="3x3">3x3 Grid</ion-select-option>
            <ion-select-option value="4x4">4x4 Grid</ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-checkbox
            [(ngModel)]="showBoundary"
            color="primary"
            justify="space-between"
          >
            Show Boundary Overlay
          </ion-checkbox>
        </ion-item>
      </ion-list>

      <ion-button (click)="startCamera()" expand="block" size="large">
        <ion-icon name="camera-outline" slot="start" />
        Start Camera with Current Settings
      </ion-button>

      <div class="quick-tests ion-margin-top">
        <ion-button
          (click)="quickTestHighQuality()"
          fill="outline"
          size="small"
        >
          <ion-icon name="star" slot="start"></ion-icon>
          High Quality Test
        </ion-button>

        <ion-button (click)="quickTestLowQuality()" fill="outline" size="small">
          <ion-icon name="star-outline" slot="start"></ion-icon>
          Low Quality Test
        </ion-button>

        <ion-button (click)="quickTestVideo()" fill="outline" size="small">
          <ion-icon name="videocam" slot="start"></ion-icon>
          Video Test
        </ion-button>
      </div>

      <div class="capture-size-tests ion-margin-top">
        <h4>Capture Size Tests</h4>
        <ion-button
          (click)="quickTestHDCapture()"
          fill="outline"
          size="small"
          color="secondary"
        >
          <ion-icon name="camera" slot="start"></ion-icon>
          HD Capture Test
        </ion-button>

        <ion-button
          (click)="quickTest4KCapture()"
          fill="outline"
          size="small"
          color="secondary"
        >
          <ion-icon name="camera" slot="start"></ion-icon>
          4K Capture Test
        </ion-button>

        <ion-button
          (click)="quickTestSquareCapture()"
          fill="outline"
          size="small"
          color="secondary"
        >
          <ion-icon name="camera" slot="start"></ion-icon>
          Square Capture Test
        </ion-button>
      </div>

      @if (testResults()) {
      <ion-card class="ion-margin-top">
        <ion-card-header>
          <ion-card-title>Test Results</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <pre>{{ testResults() }}</pre>
        </ion-card-content>
      </ion-card>
      }
    </ion-card-content>
  </ion-card>
</ion-content>
